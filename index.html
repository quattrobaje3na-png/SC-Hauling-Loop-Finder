<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMDR Quattro Logistics Tracker</title>
    <style>
        :root { --accent: #822; --bg: #0a0a0a; --panel: #1a1a1a; --text: #e0e0e0; --border: #333; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', Tahoma, sans-serif; padding: 10px; }
        .form-container { max-width: 1400px; margin: 0 auto; background: var(--panel); padding: 20px; border: 1px solid var(--border); border-radius: 4px; }
        
        h2, h3 { color: var(--accent); text-transform: uppercase; letter-spacing: 2px; margin-top: 0; border-bottom: 1px solid var(--accent); padding-bottom: 5px; font-size: 1.1rem; }
        
        .main-layout { display: grid; grid-template-columns: 420px 1fr; gap: 20px; align-items: start; }
        .delivery-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        .delivery-grid.split { grid-template-columns: 1fr 1fr; }

        .form-section { margin-bottom: 20px; }
        .input-group { display: flex; flex-direction: column; margin-bottom: 10px; }
        label { font-size: 0.7rem; margin-bottom: 3px; color: #aaa; text-transform: uppercase; }
        
        select, input { background: #222; border: 1px solid var(--border); color: white; padding: 8px; border-radius: 2px; font-size: 0.85rem; }
        select:focus, input:focus { border-color: var(--accent); outline: none; }

        .manifest-item { display: grid; grid-template-columns: 1fr 80px 30px; gap: 8px; margin-bottom: 8px; align-items: center; }
        .delivery-zone { background: #111; padding: 15px; border-top: 3px solid var(--accent); }
        
        .action-btn { background: var(--accent); color: white; border: none; padding: 10px; cursor: pointer; font-weight: bold; text-transform: uppercase; width: 100%; font-size: 0.8rem; }
        .secondary-btn { background: #333; color: white; border: 1px solid #444; padding: 8px; cursor: pointer; text-transform: uppercase; font-size: 0.7rem; }
        
        .item-split-row { display: grid; grid-template-columns: 1fr 60px; gap: 10px; margin-bottom: 5px; background: #1a1a1a; padding: 5px; border-radius: 2px; font-size: 0.8rem; }
        
        .remove-btn { background: transparent; color: #666; border: 1px solid #444; padding: 2px 6px; cursor: pointer; font-size: 0.7rem; }
        .remove-btn:hover { color: white; border-color: var(--accent); }
        
        .hidden { display: none; }
        #import-input { display: none; }
    </style>
</head>
<body>

<div class="form-container">
    <div class="input-group" style="margin-bottom: 20px;">
        <label>Manifest Title (100 Character Limit)</label>
        <input type="text" id="manifest-title" maxlength="100" placeholder="e.g., Pyro II Split Run">
    </div>

    <div class="main-layout">
        <div class="form-section" style="background: #151515; padding: 15px; border-radius: 4px;">
            <h3>Primary Pickup</h3>
            <div class="input-group"><label>System</label><select id="p-system" onchange="updateRegions('p')"></select></div>
            <div class="input-row-mini" style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div class="input-group"><label>Region</label><select id="p-region" onchange="updateLocations('p')"></select></div>
                <div class="input-group"><label>Location</label><select id="p-location"></select></div>
            </div>
            
            <label style="margin-top:15px; display:block;">Commodities</label>
            <div id="manifest-list">
                <div class="manifest-item">
                    <input type="text" class="comm-name" placeholder="Item" oninput="syncToDrops()">
                    <input type="number" class="comm-qty" placeholder="Qty" oninput="calculateTotalSCU()">
                    <button type="button" class="remove-btn" onclick="this.parentElement.remove(); calculateTotalSCU(); syncToDrops();">X</button>
                </div>
            </div>
            <button type="button" class="secondary-btn" onclick="addCommodity()">+ Add Item</button>
            
            <div class="input-group" style="margin-top: 15px;">
                <label>Total Combined SCU</label>
                <input type="number" id="total-scu" value="0" readonly style="color: var(--accent); font-weight: bold; border:none; background:transparent; font-size:1.2rem;">
            </div>
        </div>

        <div class="form-section">
            <h3>Delivery Destinations</h3>
            <div id="delivery-grid" class="delivery-grid">
                <div class="delivery-zone" id="zone-1">
                    <label style="color:var(--accent); font-weight:bold;">DROP POINT A</label>
                    <div class="input-row-mini" style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin: 10px 0;">
                        <select id="d1-system" onchange="updateRegions('d1')"></select>
                        <select id="d1-region" onchange="updateLocations('d1')"></select>
                        <select id="d1-location"></select>
                    </div>
                    <div id="d1-items"></div>
                </div>

                <div class="delivery-zone hidden" id="zone-2">
                    <div style="display:flex; justify-content:space-between;">
                        <label style="color:var(--accent); font-weight:bold;">DROP POINT B</label>
                        <button class="remove-btn" onclick="toggleSplit()">Remove</button>
                    </div>
                    <div class="input-row-mini" style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; margin: 10px 0;">
                        <select id="d2-system" onchange="updateRegions('d2')"></select>
                        <select id="d2-region" onchange="updateLocations('d2')"></select>
                        <select id="d2-location"></select>
                    </div>
                    <div id="d2-items"></div>
                </div>
            </div>
            <button type="button" class="action-btn" id="split-trigger" onclick="toggleSplit()" style="margin-top:10px;">+ Split Delivery (Multi-Drop Run)</button>
        </div>
    </div>

    <div style="display: flex; gap: 10px; margin-top:20px; border-top: 1px solid #333; padding-top:20px;">
        <input type="file" id="import-input" accept=".json" onchange="importJSON(event)">
        <button class="secondary-btn" style="flex:1" onclick="document.getElementById('import-input').click()">Import JSON Manifest</button>
        <button class="action-btn" style="flex:1" onclick="exportJSON()">Export JSON Manifest</button>
    </div>
</div>

<script>
const starCitizenData = {
    "Stanton": {
        "ArcCorp": ["Area18", "Area04", "Area06", "Area17", "Baijini Point", "ARC-L1", "ARC-L2", "ARC-L3", "ARC-L4", "ARC-L5"],
        "Wala": ["Shady Glen Farms", "ArcCorp Mining Area 045", "ArcCorp Mining Area 048", "ArcCorp Mining Area 056", "ArcCorp Mining Area 048", "ArcCorp Processing Center 115", "ArcCorp Processing Center 123"],
        "Lyria": ["Humboldt Mines", "Loveridge Mineral Reserve", "Shubin Mining Facility SAL-2", "Security Depot Lyria-1"],
        "Hurston": ["Lorville", "Everus Harbor", "HUR-L1", "HDMS-Edmond", "HDMS-Oparei", "Reclamation & Disposal Orinth"],
        "Crusader": ["Orison", "Seraphim Station", "CRU-L1", "CRU-L4", "CRU-L5"],
        "Cellin": ["Gallete Family Farms", "Terra Mills HydroFarm", "Tram & Myers Mining", "Security Post Criska"],
        "Daymar": ["Bountiful Harvest Hydroponics", "ArcCorp Mining Area 141", "Kudre Ore", "Shubin Mining Facility SCD-1", "Jump Town"],
        "Yela": ["GrimHEX", "ArcCorp Mining Area 157", "Benson Mining Outpost", "Jumptown", "NT-999-XXII", "Security Post Wan"],
        "microTech": ["New Babbage", "Port Tressler", "MIC-L1", "MT DataCenter 2UB-RB9-5", "Ghost Hollow"],
        "Calliope": ["Shubin Mining Facility SMCa-6", "Shubin Processing Facility SPMC-1", "Rayari Anvik Research Outpost"]
    },
    "Pyro": {
        "Pyro I": ["Gray Gardens Depot", "Rustville", "Stag's Rut", "Stanton Gateway", "PYR1-L2 (PYAM-FARSTAT-1-2)", "PYR1-L3 (Akiro Cluster)"],
        "Pyro II (Monox)": ["Arid Reach", "Jackson's Swap", "Last Ditch", "Ostler's Claim", "Slowburn Depot", "Sunset Mesa", "Yang's Place", "PYR2-L4 (Checkmate Station)"],
        "Pyro III (Bloom)": ["Orbituary (Rough & Ready)", "Prospect Depot", "Bueno Ravine", "Shadowfall (XenoThreat)", "PYR3-L1 (Starlight)", "PYR3-L3 (Patch City)"],
        "Pyro IV": ["Chawla's Beach", "Dinger's Depot", "Fallow Field", "Goner's Deal", "Sacren's Plot"],
        "Pyro V": ["PYR5-L1 (FARSTAT-5-1)", "PYR5-L2 (Gaslight)", "PYR5-L4 (Rod's Fuel)", "PYR5-L5 (Rat's Nest)"],
        "Pyro VI (Terminus)": ["Ruin Station (XenoThreat)", "Blackrock Exchange", "PYR6-L3 (Endgame)", "PYR6-L4 (Dudley & Daughters)", "PYR6-L5 (Megumi Refueling)"]
    },
    "Nyx": { "Delamar": ["Levski", "Mining Area 157"] }
};

let splitActive = false;

function init() {
    ['p', 'd1', 'd2'].forEach(pre => {
        const sysSel = document.getElementById(`${pre}-system`);
        Object.keys(starCitizenData).forEach(s => sysSel.add(new Option(s, s)));
        updateRegions(pre);
    });
    syncToDrops();
}

function updateRegions(pre) {
    const sys = document.getElementById(`${pre}-system`).value;
    const regSel = document.getElementById(`${pre}-region`);
    regSel.innerHTML = '';
    Object.keys(starCitizenData[sys]).forEach(r => regSel.add(new Option(r, r)));
    updateLocations(pre);
}

function updateLocations(pre) {
    const sys = document.getElementById(`${pre}-system`).value;
    const reg = document.getElementById(`${pre}-region`).value;
    const locSel = document.getElementById(`${pre}-location`);
    locSel.innerHTML = '';
    starCitizenData[sys][reg].forEach(l => locSel.add(new Option(l, l)));
}

function addCommodity() {
    const div = document.createElement('div');
    div.className = 'manifest-item';
    div.innerHTML = `<input type="text" class="comm-name" placeholder="Item" oninput="syncToDrops()">
                     <input type="number" class="comm-qty" placeholder="Qty" oninput="calculateTotalSCU()">
                     <button type="button" class="remove-btn" onclick="this.parentElement.remove(); calculateTotalSCU(); syncToDrops();">X</button>`;
    document.getElementById('manifest-list').appendChild(div);
}

function calculateTotalSCU() {
    let t = 0;
    document.querySelectorAll('.comm-qty').forEach(i => t += parseFloat(i.value) || 0);
    document.getElementById('total-scu').value = t;
    syncToDrops();
}

function syncToDrops() {
    const items = Array.from(document.querySelectorAll('.manifest-item')).map(i => ({
        n: i.querySelector('.comm-name').value || "Item",
        q: parseFloat(i.querySelector('.comm-qty').value) || 0
    }));

    ['d1', 'd2'].forEach(pre => {
        const c = document.getElementById(`${pre}-items`);
        c.innerHTML = '';
        items.forEach(item => {
            const val = splitActive ? (item.q / 2) : item.q;
            c.innerHTML += `<div class="item-split-row"><span>${item.n}</span><input type="number" value="${val}" style="width:60px; background:transparent; border:none; color:var(--accent); text-align:right;"></div>`;
        });
    });
}

function toggleSplit() {
    splitActive = !splitActive;
    document.getElementById('zone-2').classList.toggle('hidden');
    document.getElementById('delivery-grid').classList.toggle('split');
    document.getElementById('split-trigger').classList.toggle('hidden');
    syncToDrops();
}

function exportJSON() {
    const manifest = {
        title: document.getElementById('manifest-title').value.substring(0, 100),
        splitActive: splitActive,
        pickup: { sys: document.getElementById('p-system').value, reg: document.getElementById('p-region').value, loc: document.getElementById('p-location').value },
        commodities: Array.from(document.querySelectorAll('.manifest-item')).map(i => ({
            item: i.querySelector('.comm-name').value,
            total: i.querySelector('.comm-qty').value
        })),
        dropA: { sys: document.getElementById('d1-system').value, reg: document.getElementById('d1-region').value, loc: document.getElementById('d1-location').value },
        dropB: splitActive ? { sys: document.getElementById('d2-system').value, reg: document.getElementById('d2-region').value, loc: document.getElementById('d2-location').value } : null
    };
    const blob = new Blob([JSON.stringify(manifest, null, 2)], { type: "application/json" });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `${manifest.title || 'manifest'}.json`;
    a.click();
}

function importJSON(event) {
    const reader = new FileReader();
    reader.onload = (e) => {
        const data = JSON.parse(e.target.result);
        document.getElementById('manifest-title').value = data.title;
        if (data.splitActive !== splitActive) toggleSplit();
        
        loadField('p', data.pickup);
        
        const list = document.getElementById('manifest-list');
        list.innerHTML = '';
        data.commodities.forEach(c => {
            const div = document.createElement('div');
            div.className = 'manifest-item';
            div.innerHTML = `<input type="text" class="comm-name" value="${c.item}" oninput="syncToDrops()">
                             <input type="number" class="comm-qty" value="${c.total}" oninput="calculateTotalSCU()">
                             <button type="button" class="remove-btn" onclick="this.parentElement.remove(); calculateTotalSCU(); syncToDrops();">X</button>`;
            list.appendChild(div);
        });
        
        loadField('d1', data.dropA);
        if (data.splitActive) loadField('d2', data.dropB);
        calculateTotalSCU();
    };
    reader.readAsText(event.target.files[0]);
}

function loadField(pre, data) {
    document.getElementById(`${pre}-system`).value = data.sys;
    updateRegions(pre);
    document.getElementById(`${pre}-region`).value = data.reg;
    updateLocations(pre);
    document.getElementById(`${pre}-location`).value = data.loc;
}

window.onload = init;
</script>
</body>
</html>
