<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMDR Quattro Logistics Ledger</title>
    <style>
        :root { --accent: #822; --bg: #0a0a0a; --panel: #1a1a1a; --text: #e0e0e0; --border: #333; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', Tahoma, sans-serif; padding: 20px; }
        .ledger-container { max-width: 1000px; margin: 0 auto; }
        .contract-block { background: var(--panel); padding: 20px; border: 1px solid var(--border); border-radius: 4px; margin-bottom: 30px; }
        .contract-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--accent); margin-bottom: 15px; padding-bottom: 10px; }
        h2, h3 { color: var(--accent); text-transform: uppercase; letter-spacing: 2px; margin: 0; font-size: 1.1rem; }
        .form-section { margin-bottom: 20px; }
        .input-group { display: flex; flex-direction: column; margin-bottom: 10px; }
        label { font-size: 0.7rem; margin-bottom: 3px; color: #aaa; text-transform: uppercase; }
        select, input { background: #222; border: 1px solid var(--border); color: white; padding: 10px; border-radius: 2px; }
        .manifest-item { display: grid; grid-template-columns: 1fr 100px 40px; gap: 10px; margin-bottom: 10px; }
        .zone-box { background: #111; padding: 15px; border-top: 3px solid var(--accent); margin-top: 10px; }
        .action-btn { background: var(--accent); color: white; border: none; padding: 12px; cursor: pointer; font-weight: bold; text-transform: uppercase; width: 100%; }
        .secondary-btn { background: #333; color: white; border: 1px solid #444; padding: 10px; cursor: pointer; text-transform: uppercase; }
        .global-actions { position: sticky; bottom: 20px; background: rgba(10,10,10,0.95); padding: 15px; border: 1px solid var(--accent); display: flex; gap: 10px; z-index: 100; border-radius: 4px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="ledger-container" id="ledger"></div>

<div class="global-actions">
    <button class="action-btn" onclick="addNewContract()">+ Add New Contract</button>
    <input type="file" id="import-input" accept=".json" onchange="importLedger(event)" style="display:none">
    <button class="secondary-btn" onclick="document.getElementById('import-input').click()">Import Ledger JSON</button>
    <button class="action-btn" onclick="exportLedger()">Export Ledger JSON</button>
</div>

<script>
const starCitizenData = {
    "Stanton": {
        "ArcCorp": ["Area18", "Area04", "Area06", "Area17", "Baijini Point"],
        "Wala": ["Shady Glen Farms", "ArcCorp Mining Area 045", "ArcCorp Mining Area 048", "ArcCorp Mining Area 056", "ArcCorp Mining Area 061", "ArcCorp Processing Center 115", "ArcCorp Processing Center 123"],
        "Lyria": ["Humboldt Mines", "Loveridge Mineral Reserve", "Shubin Mining Facility SAL-2", "Security Depot Lyria-1"],
        "Hurston": ["Lorville", "Everus Harbor", "HUR-L1", "HDMS-Edmond", "HDMS-Oparei"],
        "Crusader": ["Orison", "Seraphim Station", "CRU-L1", "CRU-L4", "CRU-L5"],
        "Cellin": ["Gallete Family Farms", "Terra Mills HydroFarm", "Tram & Myers Mining", "Security Post Criska"],
        "Daymar": ["Bountiful Harvest Hydroponics", "ArcCorp Mining Area 141", "Kudre Ore", "Shubin Mining Facility SCD-1", "Security Post Moluto", "Security Post Prashad", "Security Post Thaquray", "Jump Town", "Brio's Breaker Yard", "Nuen Waste Management", "Whistlers Crypt", "Yadar Valley", "Dunlow Ridge Aid Shelter", "Eager Flats Aid Shelter", "Tamdon Plains Aid Shelter", "Wolf Point Aid Shelter"],
        "Yela": ["GrimHEX", "ArcCorp Mining Area 157", "Benson Mining Outpost", "Jumptown", "NT-999-XXII", "Security Post Wan"],
        "microTech": ["New Babbage", "Port Tressler", "MIC-L1", "Ghost Hollow"]
    },
    "Pyro": {
        "Pyro I": ["Gray Gardens Depot", "Rustville", "Stag's Rut", "Stanton Gateway"],
        "Pyro II (Monox)": ["Arid Reach", "Jackson's Swap", "Last Ditch", "Ostler's Claim", "Slowburn Depot", "Sunset Mesa", "Yang's Place", "PYR2-L4 (Checkmate Station)"],
        "Pyro III (Bloom)": ["Orbituary (Rough & Ready)", "Prospect Depot", "Bueno Ravine", "Shadowfall (XenoThreat)", "PYR3-L1 (Starlight)", "PYR3-L3 (Patch City)"],
        "Pyro IV": ["Chawla's Beach", "Dinger's Depot", "Fallow Field", "Goner's Deal", "Sacren's Plot"],
        "Pyro V": ["PYR5-L1 (FARSTAT-5-1)", "PYR5-L2 (Gaslight)", "PYR5-L4 (Rod's Fuel)", "PYR5-L5 (Rat's Nest)"],
        "Pyro VI (Terminus)": ["Ruin Station (XenoThreat)", "Blackrock Exchange", "PYR6-L3 (Endgame)", "PYR6-L4 (Dudley & Daughters)", "PYR6-L5 (Megumi Refueling)"]
    },
    "Nyx": { "Delamar": ["Levski", "Mining Area 157"] }
};

let contractCount = 0;

function addNewContract() {
    contractCount++;
    const id = contractCount;
    const block = document.createElement('div');
    block.className = 'contract-block';
    block.id = `contract-${id}`;
    block.innerHTML = `
        <div class="contract-header">
            <input type="text" id="title-${id}" maxlength="100" placeholder="Manifest Title (100 char limit)" style="width:70%; background:transparent; border:none; color:var(--accent); font-weight:bold;">
            <button class="secondary-btn" onclick="this.parentElement.parentElement.remove()">Delete</button>
        </div>
        <div class="form-section">
            <h3>Pickup</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
                <select id="p-sys-${id}" onchange="updateLocs(${id}, 'p')"></select>
                <select id="p-reg-${id}" onchange="updateLocs(${id}, 'p')"></select>
                <select id="p-loc-${id}"></select>
            </div>
            <label style="margin-top:10px; display:block;">Commodities</label>
            <div id="comm-list-${id}"></div>
            <button class="secondary-btn" onclick="addComm(${id})">+ Add Item</button>
        </div>
        <div class="form-section">
            <h3>Delivery</h3>
            <div class="zone-box">
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
                    <select id="d-sys-${id}" onchange="updateLocs(${id}, 'd')"></select>
                    <select id="d-reg-${id}" onchange="updateLocs(${id}, 'd')"></select>
                    <select id="d-loc-${id}"></select>
                </div>
            </div>
        </div>
    `;
    document.getElementById('ledger').appendChild(block);
    initSelectors(id);
}

function initSelectors(id) {
    ['p', 'd'].forEach(pre => {
        const sys = document.getElementById(`${pre}-sys-${id}`);
        Object.keys(starCitizenData).forEach(s => sys.add(new Option(s, s)));
        updateLocs(id, pre);
    });
}

function updateLocs(id, pre) {
    const sys = document.getElementById(`${pre}-sys-${id}`).value;
    const reg = document.getElementById(`${pre}-reg-${id}`);
    const loc = document.getElementById(`${pre}-loc-${id}`);
    const currentReg = reg.value;
    reg.innerHTML = '';
    Object.keys(starCitizenData[sys]).forEach(r => reg.add(new Option(r, r)));
    if (currentReg && starCitizenData[sys][currentReg]) reg.value = currentReg;
    loc.innerHTML = '';
    starCitizenData[sys][reg.value].forEach(l => loc.add(new Option(l, l)));
}

function addComm(id, name="", qty="") {
    const div = document.createElement('div');
    div.className = 'manifest-item';
    div.innerHTML = `<input type="text" value="${name}" placeholder="Item"><input type="number" value="${qty}" placeholder="SCU"><button class="secondary-btn" onclick="this.parentElement.remove()">X</button>`;
    document.getElementById(`comm-list-${id}`).appendChild(div);
}

function exportLedger() {
    const data = Array.from(document.querySelectorAll('.contract-block')).map(b => {
        const id = b.id.split('-')[1];
        return {
            title: document.getElementById(`title-${id}`).value,
            pSys: document.getElementById(`p-sys-${id}`).value,
            pReg: document.getElementById(`p-reg-${id}`).value,
            pLoc: document.getElementById(`p-loc-${id}`).value,
            dSys: document.getElementById(`d-sys-${id}`).value,
            dReg: document.getElementById(`d-reg-${id}`).value,
            dLoc: document.getElementById(`d-loc-${id}`).value,
            comms: Array.from(b.querySelectorAll('.manifest-item')).map(i => ({n: i.children[0].value, q: i.children[1].value}))
        };
    });
    const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `hauling_ledger_${new Date().toISOString().slice(0,10)}.json`;
    a.click();
}

function importLedger(event) {
    const reader = new FileReader();
    reader.onload = (e) => {
        const data = JSON.parse(e.target.result);
        document.getElementById('ledger').innerHTML = ''; // Clear current
        contractCount = 0;
        data.forEach(c => {
            addNewContract();
            const id = contractCount;
            document.getElementById(`title-${id}`).value = c.title;
            
            // Set values and trigger cascading updates
            document.getElementById(`p-sys-${id}`).value = c.pSys;
            updateLocs(id, 'p');
            document.getElementById(`p-reg-${id}`).value = c.pReg;
            updateLocs(id, 'p');
            document.getElementById(`p-loc-${id}`).value = c.pLoc;

            document.getElementById(`d-sys-${id}`).value = c.dSys;
            updateLocs(id, 'd');
            document.getElementById(`d-reg-${id}`).value = c.dReg;
            updateLocs(id, 'd');
            document.getElementById(`d-loc-${id}`).value = c.dLoc;

            document.getElementById(`comm-list-${id}`).innerHTML = ''; // Clear default
            c.comms.forEach(item => addComm(id, item.n, item.q));
        });
    };
    reader.readAsText(event.target.files[0]);
}

window.onload = addNewContract;
</script>
</body>
</html>
